<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Lotka-Volterra Model · LikelihoodBasedProfileWiseAnalysis.jl</title><meta name="title" content="Lotka-Volterra Model · LikelihoodBasedProfileWiseAnalysis.jl"/><meta property="og:title" content="Lotka-Volterra Model · LikelihoodBasedProfileWiseAnalysis.jl"/><meta property="twitter:title" content="Lotka-Volterra Model · LikelihoodBasedProfileWiseAnalysis.jl"/><meta name="description" content="Documentation for LikelihoodBasedProfileWiseAnalysis.jl."/><meta property="og:description" content="Documentation for LikelihoodBasedProfileWiseAnalysis.jl."/><meta property="twitter:description" content="Documentation for LikelihoodBasedProfileWiseAnalysis.jl."/><meta property="og:url" content="https://JoelTrent.github.io/LikelihoodBasedProfileWiseAnalysis.jl/examples/lotka-volterra/"/><meta property="twitter:url" content="https://JoelTrent.github.io/LikelihoodBasedProfileWiseAnalysis.jl/examples/lotka-volterra/"/><link rel="canonical" href="https://JoelTrent.github.io/LikelihoodBasedProfileWiseAnalysis.jl/examples/lotka-volterra/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LikelihoodBasedProfileWiseAnalysis.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../quick_start/">Quick Start</a></li><li><span class="tocitem">User Interface</span><ul><li><a class="tocitem" href="../../user_interface/initialisation/">Initialisation</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Parameter Profiles and Samples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../user_interface/profiles_and_samples/profile_structs/">Structs and Profile Types</a></li><li><a class="tocitem" href="../../user_interface/profiles_and_samples/univariate/">Univariate Profiles</a></li><li><a class="tocitem" href="../../user_interface/profiles_and_samples/bivariate/">Bivariate Profiles</a></li><li><a class="tocitem" href="../../user_interface/profiles_and_samples/dimensional/">Dimensional Samples</a></li></ul></li><li><a class="tocitem" href="../../user_interface/predictions/">Predictions</a></li><li><a class="tocitem" href="../../user_interface/plots/">Plots</a></li><li><a class="tocitem" href="../../user_interface/saving_and_loading/">Saving and Loading LikelihoodModels</a></li><li><a class="tocitem" href="../../user_interface/timing_and_profiling/">Timing and Profiling</a></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">Simulated Coverage Checks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../user_interface/coverage/univariate_intervals/">Parameter Confidence Intervals</a></li><li><a class="tocitem" href="../../user_interface/coverage/bivariate_boundaries/">Bivariate Parameter Confidence Boundaries</a></li><li><a class="tocitem" href="../../user_interface/coverage/predictions_and_realisations/">Predictions and Realisations</a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../">Initial Setup</a></li><li><a class="tocitem" href="../logistic/">Logistic Model</a></li><li class="is-active"><a class="tocitem" href>Lotka-Volterra Model</a><ul class="internal"><li><a class="tocitem" href="#Initial-Setup"><span>Initial Setup</span></a></li><li><a class="tocitem" href="#Model-and-Likelihood-Function-Definition"><span>Model and Likelihood Function Definition</span></a></li><li><a class="tocitem" href="#Initial-Data-and-Parameter-Definition"><span>Initial Data and Parameter Definition</span></a></li><li><a class="tocitem" href="#LikelihoodModel-Initialisation"><span>LikelihoodModel Initialisation</span></a></li><li><a class="tocitem" href="#Full-Parameter-Vector-Confidence-Set-Evaluation"><span>Full Parameter Vector Confidence Set Evaluation</span></a></li><li><a class="tocitem" href="#Profiling"><span>Profiling</span></a></li><li><a class="tocitem" href="#Predictions"><span>Predictions</span></a></li><li><a class="tocitem" href="#Coverage-Testing"><span>Coverage Testing</span></a></li></ul></li><li><a class="tocitem" href="../two-species_logistic/">Two-Species Logistic Model</a></li><li><a class="tocitem" href="../binomial_normal_approximation/">Gaussian Approximation of a Binomial Distribution</a></li><li><a class="tocitem" href="../logistic_timing_estimates/">Function Evaluation Timing - Logistic Model</a></li></ul></li><li><span class="tocitem">Internal Library</span><ul><li><a class="tocitem" href="../../internal_library/common/">Common Functions</a></li><li><a class="tocitem" href="../../internal_library/initialisation/">Initialisation</a></li><li><a class="tocitem" href="../../internal_library/ellipse_likelihood/">Ellipse Functions</a></li><li><a class="tocitem" href="../../internal_library/univariate/">Univariate Functions</a></li><li><a class="tocitem" href="../../internal_library/bivariate/">Bivariate Functions</a></li><li><a class="tocitem" href="../../internal_library/dimensional/">Dimensional Functions</a></li><li><a class="tocitem" href="../../internal_library/predictions/">Prediction Functions</a></li><li><a class="tocitem" href="../../internal_library/plots/">Plotting Functions</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Lotka-Volterra Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Lotka-Volterra Model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JoelTrent/LikelihoodBasedProfileWiseAnalysis.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JoelTrent/LikelihoodBasedProfileWiseAnalysis.jl/blob/main/docs/src/examples/lotka-volterra.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Lotka-Volterra-Model"><a class="docs-heading-anchor" href="#Lotka-Volterra-Model">Lotka-Volterra Model</a><a id="Lotka-Volterra-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Lotka-Volterra-Model" title="Permalink"></a></h1><p>The Lotka-Volterra model with a normal data distribution [<a href="../../references/#simpsonprofilewise2023">1</a>] has the following differential equations for the population size of the prey species <span>$x(t)$</span> and predator species <span>$y(t)$</span>:</p><p class="math-container">\[    \frac{\mathrm{d}x(t)}{\mathrm{d}t} = \alpha x(t) - x(t)y(t),\]</p><p class="math-container">\[    \frac{\mathrm{d}y(t)}{\mathrm{d}t} = \beta x(t)y(t) - y(t),\]</p><p>where the model parameter vector is given by <span>$\theta^M = (\alpha, \beta, x(0), y(0))$</span>. The corresponding additive Gaussian data distribution, with a fixed standard deviation, has a density function for the observed data given by: </p><p class="math-container">\[    y_i \sim p(y_i ; \theta) \sim \mathcal{N}(z_i(\theta^M), \sigma^2 \mathbb{I}),\]</p><p>where  <span>$z_i(\theta^M)=z(t_i; \theta^M) = (x(t_i; \theta^M), y(t_i; \theta^M))$</span> is the model solution of the differential equations, meaning at each <span>$t_i$</span> we have an observation of both <span>$x(t)$</span> and <span>$y(t)$</span>, <span>$y_i^\textrm{o}=(x_i^\textrm{o}, y_i^\textrm{o})$</span>, <span>$\mathbb{I}$</span> is a <span>$2\times2$</span> identity matrix and <span>$\sigma=0.2$</span>.</p><p>The true parameter values are <span>$\theta^M =(0.9, 1.1, 0.8, 0.3)$</span>. The corresponding lower and upper parameter bounds are <span>$a = (0.7, 0.7, 0.5, 0.1)$</span> and <span>$b = (1.2, 1.4, 1.2, 0.5)$</span>. Observation times are <span>$t_{1:I} = 0,0.5,1.0,...,7$</span>. The times considered for predictions are extended up to <span>$t_I=10$</span>. The original implementation can be found at <a href="https://github.com/ProfMJSimpson/Workflow">https://github.com/ProfMJSimpson/Workflow</a>. Example realisations, the true model trajectory and 95% population reference set under this parameterisation can be seen in the figure below:</p><p><img src="../../assets/figures/lotka-volterra/lotka-volterra_example.png" alt/></p><h2 id="Initial-Setup"><a class="docs-heading-anchor" href="#Initial-Setup">Initial Setup</a><a id="Initial-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-Setup" title="Permalink"></a></h2><p>Here we add six worker processes, which matches the number of bivariate profiles. For coverage testing we recommend setting this number as discussed in <a href="../#Import-Package-and-Set-Up-Distributed-Environment">Import Package and Set Up Distributed Environment</a>. We&#39;re also using <a href="https://juliaarrays.github.io/StaticArrays.jl/stable/">StaticArrays</a> to slightly speed up the differential equation solver.</p><pre><code class="language-julia hljs">using Distributed
if nprocs()==1; addprocs(6, env=[&quot;JULIA_NUM_THREADS&quot;=&gt;&quot;1&quot;]) end
@everywhere using Random, Distributions, DifferentialEquations, StaticArrays
@everywhere using LikelihoodBasedProfileWiseAnalysis
using Combinatorics</code></pre><h2 id="Model-and-Likelihood-Function-Definition"><a class="docs-heading-anchor" href="#Model-and-Likelihood-Function-Definition">Model and Likelihood Function Definition</a><a id="Model-and-Likelihood-Function-Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Model-and-Likelihood-Function-Definition" title="Permalink"></a></h2><pre><code class="language-julia hljs">@everywhere function lotka_static(C,p,t)
    dC_1=p[1]*C[1] - C[1]*C[2];
    dC_2=p[2]*C[1]*C[2] - C[2];
    SA[dC_1, dC_2]
end

@everywhere function odesolver(t,α,β,C01,C02)
    p=SA[α,β]
    C0=SA[C01,C02]
    tspan=(0.0,t[end])
    prob=ODEProblem(lotka_static,C0,tspan,p)
    sol=solve(prob, AutoTsit5(Rosenbrock23()), saveat=t);
    return sol[1,:], sol[2,:]
end

@everywhere function ODEmodel(t,θ)
    return odesolver(t,θ[1],θ[2],θ[3],θ[4])
end

@everywhere function loglhood(θ, data)
    (y1, y2) = ODEmodel(data.t, θ)
    e=loglikelihood(data.dist, data.y_obs[:, 1] .- y1)  
    f=loglikelihood(data.dist, data.y_obs[:, 2] .- y2)
    return e+f
end</code></pre><h2 id="Initial-Data-and-Parameter-Definition"><a class="docs-heading-anchor" href="#Initial-Data-and-Parameter-Definition">Initial Data and Parameter Definition</a><a id="Initial-Data-and-Parameter-Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-Data-and-Parameter-Definition" title="Permalink"></a></h2><pre><code class="language-julia hljs"># true parameters
α_true=0.9; β_true=1.1; x0_true=0.8; y0_true=0.3
@everywhere global σ=0.2
θ_true=[α_true, β_true, x0_true, y0_true]

t=LinRange(0,7,15)
y_true = hcat(ODEmodel(t, θ_true)...)
y_obs = [0.99 0.22; 1.02 0.26; 1.28 0.38; 1.92 0.36; 2.03 0.80; 1.41 1.78;
         1.54 2.04; 0.67 1.63; 0.18 1.45; 0.44 1.13; 0.74 0.94; 0.37 0.86;
         0.01 0.16; 0.65 0.52; 0.54 0.32]

# Named tuple of all data required within the log-likelihood function
data = (y_obs=y_obs, t=t, dist=Normal(0, σ))

# Bounds on model parameters 
αmin, αmax = (0.7, 1.2)
βmin, βmax = (0.7, 1.4)
x0min, x0max = (0.5, 1.2)
y0min, y0max = (0.1, 0.5)
lb_original = [αmin, βmin, x0min, y0min] .* 1.0
ub_original = [αmax, βmax, x0max, y0max] .* 1.0

αmin, αmax = (0.4, 1.5)
βmin, βmax = (0.7, 1.8)
x0min, x0max = (0.4, 1.3)
y0min, y0max = (0.02, 0.8)
lb = [αmin,βmin,x0min,y0min]
ub = [αmax,βmax,x0max,y0max]

θG = θ_true
θnames = [:α, :β, :x0, :y0]
par_magnitudes = [1,1,1,1]</code></pre><h2 id="LikelihoodModel-Initialisation"><a class="docs-heading-anchor" href="#LikelihoodModel-Initialisation">LikelihoodModel Initialisation</a><a id="LikelihoodModel-Initialisation-1"></a><a class="docs-heading-anchor-permalink" href="#LikelihoodModel-Initialisation" title="Permalink"></a></h2><pre><code class="language-julia hljs">opt_settings = create_OptimizationSettings(solve_kwargs=(maxtime=5,))
model = initialise_LikelihoodModel(loglhood, data, θnames, θG, lb, ub, par_magnitudes, optimizationsettings=opt_settings)</code></pre><h2 id="Full-Parameter-Vector-Confidence-Set-Evaluation"><a class="docs-heading-anchor" href="#Full-Parameter-Vector-Confidence-Set-Evaluation">Full Parameter Vector Confidence Set Evaluation</a><a id="Full-Parameter-Vector-Confidence-Set-Evaluation-1"></a><a class="docs-heading-anchor-permalink" href="#Full-Parameter-Vector-Confidence-Set-Evaluation" title="Permalink"></a></h2><p>To evaluate the full parameter vector confidence set at a 95% confidence level we use:</p><pre><code class="language-julia hljs">full_likelihood_sample!(model, 500000, use_distributed=true)</code></pre><h2 id="Profiling"><a class="docs-heading-anchor" href="#Profiling">Profiling</a><a id="Profiling-1"></a><a class="docs-heading-anchor-permalink" href="#Profiling" title="Permalink"></a></h2><h3 id="Univariate-Profiles"><a class="docs-heading-anchor" href="#Univariate-Profiles">Univariate Profiles</a><a id="Univariate-Profiles-1"></a><a class="docs-heading-anchor-permalink" href="#Univariate-Profiles" title="Permalink"></a></h3><p>To find the confidence intervals for all three parameters at a 95% confidence level (the default), we use:</p><pre><code class="language-julia hljs">univariate_confidenceintervals!(model)</code></pre><p>Similarly, if we wish to find simultaneous 95% confidence intervals for the parameters we set the degrees of freedom parameter, <code>dof</code>, to the number of model parameters (instead of <code>1</code>).</p><pre><code class="language-julia hljs">univariate_confidenceintervals!(model, dof=model.core.num_pars) # model.core.num_pars=4</code></pre><h3 id="Bivariate-Profiles"><a class="docs-heading-anchor" href="#Bivariate-Profiles">Bivariate Profiles</a><a id="Bivariate-Profiles-1"></a><a class="docs-heading-anchor-permalink" href="#Bivariate-Profiles" title="Permalink"></a></h3><p>To evaluate the bivariate boundaries for all six bivariate parameter combinations, here we use the <a href="../../user_interface/profiles_and_samples/bivariate/#LikelihoodBasedProfileWiseAnalysis.IterativeBoundaryMethod"><code>IterativeBoundaryMethod</code></a>, which uses a 10 point ellipse approximation of the boundary as a starting guess using <a href="../../user_interface/profiles_and_samples/bivariate/#LikelihoodBasedProfileWiseAnalysis.RadialMLEMethod"><code>RadialMLEMethod</code></a>. The boundaries in this example are reasonably convex, which makes this starting guess appropriate. To speed up computation we provide stronger optimization settings.</p><pre><code class="language-julia hljs">opt_settings = create_OptimizationSettings(solve_kwargs=(maxtime=5, xtol_rel=1e-12))
bivariate_confidenceprofiles!(model, 30, 
    method=IterativeBoundaryMethod(20, 5, 5, 0.15, 1.0, use_ellipse=true), 
    optimizationsettings=opt_settings)</code></pre><p>Similarly, if we wish to evaluate simultaneous 95% bivariate profiles we set the degrees of freedom parameter, <code>dof</code>, to the number of model parameters (instead of <code>2</code>).</p><pre><code class="language-julia hljs">opt_settings = create_OptimizationSettings(solve_kwargs=(maxtime=5, xtol_rel=1e-12))
bivariate_confidenceprofiles!(model, 30, 
    method=IterativeBoundaryMethod(20, 5, 5, 0.15, 1.0, use_ellipse=true), 
    dof=model.core.num_pars,
    optimizationsettings=opt_settings)</code></pre><h3 id="Plots-of-Profiles"><a class="docs-heading-anchor" href="#Plots-of-Profiles">Plots of Profiles</a><a id="Plots-of-Profiles-1"></a><a class="docs-heading-anchor-permalink" href="#Plots-of-Profiles" title="Permalink"></a></h3><p>To visualise plots of these profiles we load <a href="https://docs.juliaplots.org/stable/">Plots</a> alongside a plotting backend. Here we use <a href="https://github.com/jheinen/GR.jl">GR</a>.</p><pre><code class="language-julia hljs">using Plots; gr()</code></pre><p>Univariate and bivariate profiles can either be visualised individually or in comparison to profiles at the same confidence level and degrees of freedom. </p><p>Here we plot the univariate profiles formed at a 95% confidence level and 1 degree of freedom.</p><pre><code class="language-julia hljs">plts = plot_univariate_profiles(model, confidence_level=0.95, dof=1)

plt = plot(plts..., layout=(1,4))
display(plt)</code></pre><p>Similarly, here we plot the simultaneous bivariate profiles formed at a 95% confidence level and 4 degrees of freedom.</p><pre><code class="language-julia hljs">plts = plot_bivariate_profiles(model, confidence_level=0.95, dof=model.core.num_pars)

plt = plot(plts..., layout=(2,3))
display(plt)</code></pre><h2 id="Predictions"><a class="docs-heading-anchor" href="#Predictions">Predictions</a><a id="Predictions-1"></a><a class="docs-heading-anchor-permalink" href="#Predictions" title="Permalink"></a></h2><p>To make predictions for the model trajectory and the <span>$1-\delta$</span> population reference set we define the following functions, which then need to be added to our <a href="../../user_interface/initialisation/#LikelihoodBasedProfileWiseAnalysis.LikelihoodModel"><code>LikelihoodModel</code></a>. The <code>region</code> variable in <code>errorfunction</code> should be set equal to <span>$1-\delta$</span> when generating predictions. These could also be added in <a href="../../user_interface/initialisation/#LikelihoodBasedProfileWiseAnalysis.initialise_LikelihoodModel"><code>initialise_LikelihoodModel</code></a>.</p><pre><code class="language-julia hljs">@everywhere function predictfunction(θ, data, t=data.t)
    y1, y2 = ODEmodel(t, θ) 
    y = hcat(y1,y2)
    return y
end

@everywhere function errorfunction(predictions, θ, region); normal_error_σ_known(predictions, θ, region, σ) end

add_prediction_function!(model, predictfunction)
add_error_function!(model, errorfunction)</code></pre><p>To generate profile-wise predictions for each of the evaluated profiles we first define the desired time points for prediction and then evaluate the approximate model trajectory confidence sets and <span>$(1-\delta, 1-\alpha)$</span> population reference tolerance sets. By default, the population reference tolerance set evaluates reference interval regions at the same level as the default confidence level (<span>$1-\delta = 1-\alpha = 0.95$</span>); however, this is not required. We are making predictions outside the range of the data used to evaluate the profiles.</p><pre><code class="language-julia hljs">t_pred=LinRange(0,10,201)

generate_predictions_univariate!(model, t_pred)
generate_predictions_bivariate!(model, t_pred)
generate_predictions_dim_samples!(model, t_pred) # for the full likelihood sample</code></pre><h3 id="Plotting-Predictions"><a class="docs-heading-anchor" href="#Plotting-Predictions">Plotting Predictions</a><a id="Plotting-Predictions-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Predictions" title="Permalink"></a></h3><p>We can plot the predictions of individual profiles or the union of all profiles at a given number of interest parameters, confidence level, degrees of freedom and reference interval region (if relevant). When plotting the union of these predictions we can compare it to the result of the full likelihood sample, which here used <a href="../../user_interface/profiles_and_samples/dimensional/#LikelihoodBasedProfileWiseAnalysis.LatinHypercubeSamples"><code>LatinHypercubeSamples</code></a>, the default. Here we plot the results from simultaneous profiles.</p><h4 id="Model-Trajectory"><a class="docs-heading-anchor" href="#Model-Trajectory">Model Trajectory</a><a id="Model-Trajectory-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Trajectory" title="Permalink"></a></h4><pre><code class="language-julia hljs">using Plots; gr()
plot_predictions_union(model, t_pred, 1, dof=model.core.num_pars,
    compare_to_full_sample_type=LatinHypercubeSamples()) # univariate profiles</code></pre><pre><code class="language-julia hljs">plot_predictions_union(model, t_pred, 2, dof=model.core.num_pars,
    compare_to_full_sample_type=LatinHypercubeSamples()) # bivariate profiles</code></pre><h4 id="1-\\delta-Population-Reference-Set"><a class="docs-heading-anchor" href="#1-\\delta-Population-Reference-Set"><span>$1-\delta$</span> Population Reference Set</a><a id="1-\\delta-Population-Reference-Set-1"></a><a class="docs-heading-anchor-permalink" href="#1-\\delta-Population-Reference-Set" title="Permalink"></a></h4><pre><code class="language-julia hljs">using Plots; gr()
plot_realisations_union(model, t_pred, 1, dof=model.core.num_pars,
    compare_to_full_sample_type=LatinHypercubeSamples()) # univariate profiles</code></pre><pre><code class="language-julia hljs">plot_realisations_union(model, t_pred, 2, dof=model.core.num_pars, 
    compare_to_full_sample_type=LatinHypercubeSamples()) # bivariate profiles</code></pre><h2 id="Coverage-Testing"><a class="docs-heading-anchor" href="#Coverage-Testing">Coverage Testing</a><a id="Coverage-Testing-1"></a><a class="docs-heading-anchor-permalink" href="#Coverage-Testing" title="Permalink"></a></h2><p>To conduct an investigation into the coverage properties of the profiles and profile-wise predictions sets we can perform a simulation study using the provided coverage functions. The procedures are effectively identical to those used for the <a href="../logistic/#Logistic-Model">Logistic Model</a>; the commentary for that example remains true for this example. </p><h3 id="Data-Generation"><a class="docs-heading-anchor" href="#Data-Generation">Data Generation</a><a id="Data-Generation-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Generation" title="Permalink"></a></h3><p>First we define functions and arguments which we use to simulate new training and testing data, and evaluate the true <span>$1-\delta$</span> population reference set, given the true parameter values. </p><pre><code class="language-julia hljs"># DATA GENERATION FUNCTION AND ARGUMENTS
@everywhere function data_generator(θtrue, generator_args::NamedTuple)
    y_obs = generator_args.y_true .+ rand(generator_args.dist, length(generator_args.t), 2)
    if generator_args.is_test_set; return y_obs end
    data = (y_obs=y_obs, generator_args...)
    return data
end

@everywhere function reference_set_generator(θtrue, generator_args::NamedTuple, region::Float64)
    lq, uq = errorfunction(generator_args.y_true, θtrue, region)
    return (lq, uq)
end

training_gen_args = (y_true=y_true, t=t, dist=Normal(0, σ), is_test_set=false)
testing_gen_args = (y_true=hcat(ODEmodel(t_pred, θ_true)...), t=t_pred, dist=Normal(0, σ), is_test_set=true)</code></pre><h4 id="Parameter-Confidence-Intervals"><a class="docs-heading-anchor" href="#Parameter-Confidence-Intervals">Parameter Confidence Intervals</a><a id="Parameter-Confidence-Intervals-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-Confidence-Intervals" title="Permalink"></a></h4><p>Coverage of parameter confidence intervals:</p><pre><code class="language-julia hljs">opt_settings = create_OptimizationSettings(solve_kwargs=(maxtime=5, xtol_rel=1e-12))

uni_coverage_df = check_univariate_parameter_coverage(data_generator,
    training_gen_args, model, 1000, θ_true, collect(1:model.core.num_pars),
    optimizationsettings=opt_settings)</code></pre><h4 id="Bivariate-Profiles-2"><a class="docs-heading-anchor" href="#Bivariate-Profiles-2">Bivariate Profiles</a><a class="docs-heading-anchor-permalink" href="#Bivariate-Profiles-2" title="Permalink"></a></h4><p>Coverage of the true value of each set of bivariate interest parameters:</p><pre><code class="language-julia hljs">opt_settings = create_OptimizationSettings(solve_kwargs=(maxtime=5, xtol_rel=1e-12))

biv_coverage_df = check_bivariate_parameter_coverage(data_generator,
    training_gen_args, model, 1000, 50, θ_true, 
    collect(combinations(1:model.core.num_pars, 2)),
    method = IterativeBoundaryMethod(20, 5, 5, 0.15, 0.1, use_ellipse=true), 
    optimizationsettings=opt_settings)</code></pre><p>Coverage of the true bivariate boundary. 5000 samples corresponds to around 200-400 retained points:</p><pre><code class="language-julia hljs">opt_settings = create_OptimizationSettings(solve_kwargs=(maxtime=5, xtol_rel=1e-12))

biv_boundary_coverage_df = check_bivariate_boundary_coverage(data_generator,
    training_gen_args, model, 100, 30, 5000, θ_true,
    collect(combinations(1:model.core.num_pars, 2)); 
    method=IterativeBoundaryMethod(20, 5, 5, 0.15, 0.1, use_ellipse=true), 
    coverage_estimate_quantile_level=0.9,
    optimizationsettings=opt_settings)</code></pre><h3 id="Prediction-Coverage"><a class="docs-heading-anchor" href="#Prediction-Coverage">Prediction Coverage</a><a id="Prediction-Coverage-1"></a><a class="docs-heading-anchor-permalink" href="#Prediction-Coverage" title="Permalink"></a></h3><h4 id="Model-Trajectory-2"><a class="docs-heading-anchor" href="#Model-Trajectory-2">Model Trajectory</a><a class="docs-heading-anchor-permalink" href="#Model-Trajectory-2" title="Permalink"></a></h4><p>To test the coverage of the true model trajectory we can use <a href="../../user_interface/coverage/predictions_and_realisations/#LikelihoodBasedProfileWiseAnalysis.check_dimensional_prediction_coverage"><code>check_dimensional_prediction_coverage</code></a>, <a href="../../user_interface/coverage/predictions_and_realisations/#LikelihoodBasedProfileWiseAnalysis.check_univariate_prediction_coverage"><code>check_univariate_prediction_coverage</code></a> and <a href="../../user_interface/coverage/predictions_and_realisations/#LikelihoodBasedProfileWiseAnalysis.check_bivariate_prediction_coverage"><code>check_bivariate_prediction_coverage</code></a>. Again we use the default 95% confidence level here. Given a sufficient number of sampled points we expect the model trajectory coverage from the trajectory confidence set from propagating forward the full parameter vector 95% confidence set to have 95% simultaneous coverage. </p><div class="admonition is-danger"><header class="admonition-header">Using manual GC calls</header><div class="admonition-body"><p>On versions of Julia earlier than 1.10, we recommend setting the kwarg, <code>manual_GC_calls</code>, to true in each of the coverage functions. Otherwise the garbage collector may not successfully free memory every iteration leading to out of memory errors.</p></div></div><pre><code class="language-julia hljs">opt_settings = create_OptimizationSettings(solve_kwargs=(maxtime=5, xtol_rel=1e-12))

full_trajectory_coverage_df = check_dimensional_prediction_coverage(data_generator, 
    training_gen_args, t_pred, model, 1000, 500000, 
    θ_true, [collect(1:model.core.num_pars)])

uni_trajectory_coverage_df = check_univariate_prediction_coverage(data_generator, 
    training_gen_args, t_pred, model, 1000, 
    θ_true, collect(1:model.core.num_pars), 
    num_points_in_interval=20, 
    optimizationsettings=opt_settings)

biv_trajectory_coverage_df = check_bivariate_prediction_coverage(data_generator, 
    training_gen_args, t_pred, model, 1000, 30, θ_true, 
    collect(combinations(1:model.core.num_pars, 2)),
    method=IterativeBoundaryMethod(20, 5, 5, 0.15, 0.1, use_ellipse=true),
    optimizationsettings=opt_settings)</code></pre><p>Repeating the coverage of univariate and bivariate profiles using the profile path approach:</p><pre><code class="language-julia hljs">uni_trajectory_coverage_df = check_univariate_prediction_coverage(data_generator, 
    training_gen_args, t_pred, model, 1000, 
    θ_true, collect(1:model.core.num_pars), 
    dof=model.core.num_pars,
    num_points_in_interval=20, 
    optimizationsettings=opt_settings)

biv_trajectory_coverage_df = check_bivariate_prediction_coverage(data_generator, 
    training_gen_args, t_pred, model, 1000, 30, θ_true, 
    collect(combinations(1:model.core.num_pars, 2)),
    dof=model.core.num_pars,
    method=IterativeBoundaryMethod(20, 5, 5, 0.15, 0.1, use_ellipse=true),
    optimizationsettings=opt_settings)</code></pre><h4 id="1-\\delta-Population-Reference-Set-and-Observations"><a class="docs-heading-anchor" href="#1-\\delta-Population-Reference-Set-and-Observations"><span>$1-\delta$</span> Population Reference Set and Observations</a><a id="1-\\delta-Population-Reference-Set-and-Observations-1"></a><a class="docs-heading-anchor-permalink" href="#1-\\delta-Population-Reference-Set-and-Observations" title="Permalink"></a></h4><p>To test the coverage of the <span>$1-\delta$</span> population reference set as well as observations we can use <a href="../../user_interface/coverage/predictions_and_realisations/#LikelihoodBasedProfileWiseAnalysis.check_dimensional_prediction_realisations_coverage"><code>check_dimensional_prediction_realisations_coverage</code></a>, <a href="../../user_interface/coverage/predictions_and_realisations/#LikelihoodBasedProfileWiseAnalysis.check_univariate_prediction_realisations_coverage"><code>check_univariate_prediction_realisations_coverage</code></a> and <a href="../../user_interface/coverage/predictions_and_realisations/#LikelihoodBasedProfileWiseAnalysis.check_bivariate_prediction_realisations_coverage"><code>check_bivariate_prediction_realisations_coverage</code></a>. Here we will only look at the coverage for simultaneous profiles.</p><div class="admonition is-danger"><header class="admonition-header">Using manual GC calls</header><div class="admonition-body"><p>On versions of Julia earlier than 1.10, we recommend setting the kwarg, <code>manual_GC_calls</code>, to true in each of the coverage functions. Otherwise the garbage collector may not successfully free memory every iteration leading to out of memory errors.</p></div></div><pre><code class="language-julia hljs">full_reference_coverage_df = check_dimensional_prediction_realisations_coverage(data_generator,
    reference_set_generator, training_gen_args, testing_gen_args, t_pred, model, 1000, 500000, 
    θ_true, [collect(1:model.core.num_pars)])

uni_reference_coverage_df = check_univariate_prediction_realisations_coverage(data_generator,
    reference_set_generator, training_gen_args, testing_gen_args, t_pred, model, 1000, 
    θ_true, collect(1:model.core.num_pars), 
    dof=model.core.num_pars,
    num_points_in_interval=20, 
    optimizationsettings=opt_settings)

biv_reference_coverage_df = check_bivariate_prediction_realisations_coverage(data_generator,
    reference_set_generator, training_gen_args, testing_gen_args, t_pred, model, 1000, 20, θ_true, 
    collect(combinations(1:model.core.num_pars, 2)),
    dof=model.core.num_pars,
    method=IterativeBoundaryMethod(20, 5, 5, 0.15, 0.1, use_ellipse=true),
    optimizationsettings=opt_settings)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../logistic/">« Logistic Model</a><a class="docs-footer-nextpage" href="../two-species_logistic/">Two-Species Logistic Model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Friday 2 February 2024 03:49">Friday 2 February 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
